# MVCC

- MVCC (Multi-Version Concurrency Control)는 데이터베이스 시스템에서 동시에 여러 트랜잭션을 안전하게 처리하기 위해 사용되는 기술입니다. 
- MVCC와 데이터베이스 락(데이터베이스 잠금)은 모두 트랜잭션의 격리성과 일관성을 보장하기 위한 방법이지만, 그 접근 방식이 다릅니다.


### 데이터베이스 락(Database Lock)
- 데이터베이스 락은 트랜잭션이 데이터에 접근하는 것을 제어하기 위해 잠금을 사용하는 방식입니다. 
- 일반적으로 두 가지 유형의 잠금이 있습니다:


- **읽기 락 (Shared Lock):** 데이터 읽기를 허용하지만 쓰기는 허용하지 않습니다. 여러 트랜잭션이 동시에 읽을 수 있습니다.
- **쓰기 락(Exclusive Lock):** 데이터 읽기와 쓰기 모두를 막습니다. 잠금을 획득한 트랜잭션만 데이터에 접근할 수 있습니다.

잠금 메커니즘의 주요 단점은 다음과 같습니다:
- **교착 상태(Deadlock):** 두 개 이상의 트랜잭션이 서로의 잠금을 기다리면서 무한 대기 상태에 빠질 수 있습니다.
- **성능 저하:** 잠금 경합으로 인해 트랜잭션이 대기 상태에 놓이면 성능이 저하될 수 있습니다.

### MVCC (Multi-Version Concurrency Control)
- MVCC는 데이터베이스가 **각 데이터의 여러 버전을 유지함**으로써 트랜잭션 간의 충돌을 피하는 방법입니다. 
- 트랜잭션이 데이터를 읽을 때, 데이터베이스는 **트랜잭션이 시작된 시점의 일관된 스냅샷을 제공**합니다.
- 즉, 각 트랜잭션은 자신만의 데이터 버전을 보게 됩니다.

MVCC의 주요 특징은 다음과 같습니다:
- **버전 관리:** 각 트랜잭션이 데이터의 다른 버전을 읽고 쓸 수 있도록 데이터베이스는 변경된 데이터를 버전으로 관리합니다.
- **읽기 일관성(Read Consistency):** 트랜잭션이 데이터를 읽을 때마다 일관된 스냅샷을 보장하여 읽기 작업이 차단되지 않습니다.
- **충돌 방지:** 동시에 실행되는 트랜잭션 간의 충돌을 피할 수 있습니다.

MVCC의 장점:
- **향상된 성능:** 읽기 작업이 다른 읽기나 쓰기 작업에 의해 차단되지 않기 때문에 성능이 향상됩니다.
- **교착 상태 방지:** 트랜잭션이 서로를 차단하지 않으므로 교착 상태가 발생하지 않습니다.

MVCC의 단점:
- **메모리 사용:** 여러 버전의 데이터를 유지해야 하므로 메모리 사용량이 증가할 수 있습니다.
- **정리 작업:** 더 이상 필요 없는 데이터 버전을 정리하는 작업이 필요합니다.

### 비교

| 특징             | 데이터베이스 락                              | MVCC                                |
|------------------|---------------------------------------------|-------------------------------------|
| **동시성 제어**   | 잠금(공유 잠금, 배타 잠금) 사용              | 여러 버전의 데이터 관리             |
| **교착 상태**     | 발생 가능                                    | 발생하지 않음                      |
| **성능**         | 잠금 경합으로 성능 저하 가능                  | 읽기 작업 차단 없음, 성능 향상     |
| **읽기 일관성**   | 잠금 상태에 따라 다름                        | 일관된 스냅샷 제공                 |
| **메모리 사용**   | 상대적으로 적음                              | 여러 버전 유지로 메모리 사용 증가  |
| **정리 작업**     | 필요 없음                                    | 더 이상 필요 없는 버전 정리 필요   |

### 요약
- **데이터베이스 락**은 잠금을 사용하여 트랜잭션 간의 동시 접근을 제어하지만, 교착 상태 및 성능 저하 문제가 발생할 수 있습니다.
- **MVCC**는 여러 버전의 데이터를 유지하여 읽기 작업이 차단되지 않도록 하며, 교착 상태를 방지하고 성능을 향상시키지만, 메모리 사용이 증가하고 불필요한 데이터 버전을 정리해야 하는 단점이 있습니다.

이 두 가지 방법은 트랜잭션의 격리성과 일관성을 보장하기 위해 사용되며, 데이터베이스 시스템의 요구 사항에 따라 적절히 선택되어 사용됩니다.


