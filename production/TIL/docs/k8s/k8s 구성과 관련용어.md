# 쿠버네티스의 구성과 관련 용어

## 파드는 컨테이너와 볼륨을 함께 묶은 것이다.

- k8s에서 컨테이너는 파드(pod) 라는 단위로 관리됨
- 기본적으로 파드 하나가 컨테이너 하나지만, 컨테이너가 여러개인 파드가 있을 수 있다.

- 파드에 포함되는 볼륨은 기본적으로 함께 **파드에 포함되는 컨테이너가 정보를 공유하기 위해 사용되는 것**
- 파드에 볼륨이 없는 경우도 많다

## 파드가 모여 구성하는 서비스

- 이들 파드를 모은 것이 서비스다
- 여기서 말하는 서비스는 **여러개의 파드를 이끄는 반장**이라고 생각하면 편함
- 서비스가 관리하는 파드는 모두 기본적으로 동일한 구성
    - 구성이 다른 파드는 별도의 서비스로 관리한다.
- 서비스는 파드가 여러개의 워커 노드(물리적 서버)에 걸쳐 동작하더라도, 이들을 모두 관리

---
**서비스의 역할은 쉽게 말해 로드 밸런서**

- 각 서비스는 자동적으로 고정된 IP 주소(cluster IP)를 부여 받음
    - 이 주소로 들어오는 통신을 처리
- 내부적으로는 여러 개의 파드가 있어도 밖에서는 하나의 IP 주소 (cluster IP)만 볼 수 있다
    - 이 주소로 접근하면 서비스가 통신을 적절히 분배 해줌


- **하지만 서비스가 분배하는 통신은 한 워커 노드 안으로 국한 된다.**
- 여러 워커 노드 간의 분배는 -> **실제 로드 밸런서 또는 ingress 가 담당**
    - 이들은 마스터, 워커 노드도 아닌 별도의 노드에서 동작하거나, 물리적 전용 하드웨어다

## deployment 와 레플리카 세트

### 레플리카 세트

- 레플리카 세트는 **파드의 수를 관리하는 반장**
    - 장애 등의 이유로 파드가 종료되었을 때, 모자라는 파드를 보충하거나
    - 정의 파일에 정의된 파드의 수가 감소하면 -> 그만큼의 파드의 수를 실제로 감소


- 레플리카 세트가 관리하는 동일한 구성의 파드를 **레플리카** 라고 함

- 그래서 파드의 수를 조정하는 것을 '레플리카의 수를 조정' 한다고 하거나 ,
- 파드의 수를 결정하는 것도 '레플리카의 수를 결정' 한다고 표현 하기도 함!

---

- 레플리카 세트는 단독으로 쓰이는 경우가 드물다
    - 왜냐면 원하는 대로 다루기 어렵기 때문
    - -> 따라서 레플리카 세트는 **deployment와 함께 쓰일 때가 많다.**

### deployment

- 파드의 deploy(배포)를 관리하는 요소
- 파드가 사용하는 이미지등 파드에 대한 정보를 가지고 있다.
- 레플리카 세트가 반장이라면 deployment 는 반장보다 위에 있는 상사!

- deployment는 레플리카 세트를 관리하고, 레플리카 세트는 파드를 관리한다.

## 그 밖의 k8s 리소스

- 파드, 서비스, deployment, 레플리카 세트 등을 **리소스** 라고 한다.

## 서비스 리소스의 유형 (type) 설정

- 외부로부터 서비스에 어떤 유형의 IP 주소 (또는 DNS)로 접근할지를 설정

| 유형 이름        | 내용                              |
|--------------|---------------------------------|
| ClusterIP    | 클러스터IP를 통해 서비스에 접근(외부에서는 접근 불가) |
| NodePort     | 워커 노드의 IP를 통해 서비스에 접근           |
| LoadBalancer | 로드밸런서의 IP를 통해 서비스에 접근하도록 함      |
| ExternalName | 파드에서 서비스를 통해 외부로 나가기 위한 설정      |

- ClusterIP 로 설정하면 클러스터IP를 통해 서비스에 접근 가능 
- ClusterIP 는 사설 IP 주소라서 클러스터 내부의 통신에만 사용 가능!

- 사용자를 웹 사이트에 접근시키려면 유형 이름을 'LoadBalancer' 로 하고 로드밸런서의 IP 주소로 접근하게 한다. 
- 이렇게 하면 로드밸런서가 서비스에 접근하도록 설정되어 사용자가 웹 사이트에 접근 가능

- NodePort 로 설정하면 워커 노드에 직접 접근할 수 있다